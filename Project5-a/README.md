## Project 5(a): SM2软件实现和优化
### 原理
SM2是我国国家密码管理局颁布的商用公钥密码标准算法的一种，它本质是一组椭圆曲线密码算法。由于其加密流程的复杂性，SM2的实现往往需要与SM3进行结合，使用SM3辅助其完成密钥派生KDF和消息完整性校验HASH过程。

其加密算法大致流程如下：

1、密钥产生，接收方B密钥取{1,2,...,n-1}的一个随机数d，其公钥 $P_{B}$ 便为椭圆曲线上的点 $d \cdot G$ ( $G = G(x,y)$ 为一个基点)；

2、假定发送方为A，A要发送消息M，长度为nlen；

3、从{1,2,...,n-1}中选择随机数k；

4、计算椭圆曲线点 $C_{1}=k \cdot G=(x_{1},y_{1})$；

5、再计算点 $S=h \cdot P_{B}$；

6、最后计算椭圆曲线点 $k \cdot P_{B}=(x_{1},x_{2})$；

7、在上述椭圆曲线点得出的情况下，计算 $t=KDF(x_{2} \parallel y_{2},nlen)$；

8、计算 $C_{2}=M \oplus t$；

9、进而计算 $C_{3}=Hash(x_{2} \parallel M \parallel y_{2})$；

10、最终输出密文 $C=(C_{1},C_{2},C_{3})$。
### 代码思路
首先我们实现前置的SM3摘要生成部分，此部分包括置换函数P0()和P1()，循环左移函数move()以及三个布尔函数TT()(根据索引返回常量值)、FF()和GG()(两个用于压缩的函数)。

之后需要定义填充和消息扩展函数，用于对数据进行填充并将输入的数据拆分成组，并使用置换函数和move()函数对其进行扩展，得到多个32位整数。

到此SM2前置所需的SM3部分基本完成，现在构建椭圆曲线算法，第一步先定义曲线的参数，包括曲线方程的系数，基点G的坐标，私钥d等(这些部分参照标准参数定义)。

第二步定义基本的曲线计算函数，包括点加法和双重加速算法。完成后我们可以由双重加速加法算法算得公钥。

之后实现密钥派生函数KDF()，根据输入的种子z和密钥长度nlen生成密钥。将该函数结合进加密函数encrytp()中，就能实现完整的SM2加密流程。

本次实践测试消息内容为"SDUzxj"，加密结果的随机公钥点C1，密文数据C2和校验值C3均会在程序运行完成后打印。
### 结果分析
<img width="853" height="291" alt="result" src="https://github.com/user-attachments/assets/e2effc3a-97a2-4526-b157-84c2f8f42547" />
由上述结果可以看到，我们对指定文本进行SM2加密成功，且加密效率较高。
